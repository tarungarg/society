<section class="content-header">
  <h1>
    Complaint
    <small>Raise Your Voice</small>
  </h1>
  <ol class="breadcrumb">
    <li><a href="/"><i class="fa fa-dashboard"></i> Home</a></li>
    <li class="active">Complaints</li>
  </ol>
</section>

<section class="content">
  <div class="box">
    <div class="box-header">
      <h3 class="box-title"> Complaint Information</h3>
      <div class="box-tools">
      </div>
    </div>
    <div class="box-body">
      <input type="hidden" id='complaint_id' value="<%= @complaint.id%>"></input>
      <table class="table">
        <% if user_is_president %>
          <% if @complaint.random == 0%>
            <tr>
              <td>Submitted By::</td>
              <td><%= @complaint.user.name %></td>
            </tr>
            <tr>
              <td>Flat No:</td>
              <td><%= @complaint.user.flat_no %></td>
            </tr>
          <% else %>
            <tr>
              <td>Submitted By::</td>
              <td>Anonymous</td>
            </tr>
          <% end %>
        <% end %>

        <tr>
          <td>Posted on:</td>
          <td><%= convert_time_to_basic(@complaint.created_at) %></td>
        </tr>

        <tr>
          <td>Title:</td>
          <td><%= @complaint.title %></td>
        </tr>

        <tr>
          <td>Desc:</td>
          <td><%= @complaint.desc %></td>
        </tr>

        <tr>
          <td>Status:</td>
          <td><%= @complaint.status %></td>
        </tr>
      </table>
    </div>
  </div>
  <div class="box">
    <div class="box-body">
      <div class="complaint-reviews">
        <% @complaint.reviews.each_with_index do |review, index| %>
          <%= render partial: 'complaints/partials/list_review', locals: {review: review} %>
        <% end %>
      </div>

      <p>
        <% if user_is_president %>
          <%= form_tag create_review_complaint_path(@complaint), :id=>"president-review-form", :remote=>true do %>
            <%= text_area_tag :review, '', cols: 50, rows: 5, required: true %><br>
            <%= submit_tag 'Submit Your Review', class: 'btn btn-default' %>
          <% end %>
        <% end %>
      </p>

      <%= link_to 'Edit', edit_complaint_path(@complaint) if @complaint.user_id == current_user.id%> |
      <%= link_to 'Back', complaints_path %> |

      <span class='upvote-comment-section'>
        <%= link_to_unless current_user.voted_for?(@complaint),'Upvote', upvote_complaint_path(@complaint), method: 'PUT', remote: true %>
      </span>
      (<span id="complaint_vote_<%=@complaint.id%>"><%= @complaint.get_upvotes.size %></span>)

      <!-- User can mark as resolve -->
      <% if current_user.id == @complaint.user_id %>
        <div class="pull-right">
          <% if @complaint.status == 'Resolved' %>
           <%= link_to 'Open', mark_as_unresolve_complaint_path(@complaint.id), class: 'btn btn-success resolve-complaint-btn', method: 'PUT', remote: true %>
          <% else %>
           <%= link_to 'Mark As Resolve', mark_as_resolve_complaint_path(@complaint.id), class: 'btn btn-success resolve-complaint-btn', method: 'PUT', remote: true %>
          <% end %>
        </div>
      <% end %>
        <!-- User can mark as resolve -->
    </div>
  </div>
  <%= commontator_thread(@complaint) if @complaint.view_publically %>
</section>